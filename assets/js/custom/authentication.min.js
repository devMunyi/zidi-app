function validateRegForm(){const e=$("#username_input").val().trim(),r=$("#fullname_input").val().trim(),s=$("#email_input").val().trim(),t=$("#country_input").val().trim(),a=$("#password_input").val().trim(),o=$("#cpassword_input").val().trim();let n=fullnameErr=emailErr=countryErr=passwordErr=cpasswordErr=!0;if(""==e)printError("usernameErr","Please enter your username");else{var i=/^[a-zA-Z\s]+$/;!1===i.test(e)?printError("usernameErr","Please enter a valid username"):(printError("usernameErr",""),n=!1)}if(""==r)printError("fullnameErr","Please enter your fullname");else{i=/^[a-zA-Z\s]+$/;!1===i.test(e)?printError("fullnameErr","Please enter a valid fullname"):(printError("fullnameErr",""),fullnameErr=!1)}if(""==s)printError("emailErr","Please enter your email address");else{i=/^\S+@\S+\.\S+$/;!1===i.test(s)?printError("emailErr","Please enter a valid email address"):(printError("emailErr",""),emailErr=!1)}if(""==t?printError("countryErr","Please select your country"):(printError("countryErr",""),countryErr=!1),""==a?printError("passwordErr","Please enter your password"):a.length<6?printError("passwordErr","Your password should be min 6 characters"):(printError("passwordErr",""),passwordErr=!1),""==o?printError("cpasswordErr","Please confirm your password"):o!==a?printError("cpasswordErr","Confirm password should match"):(printError("cpasswordErr",""),cpasswordErr=!1),1==(n||fullnameErr||emailErr||countryErr||passwordErr||cpasswordErr))return!1;data={username:e,fullname:r,email:s,country:t,password:a,cpassword:o},register(data)}function register(e){disabledBtn("#regBtn");let r=0,s="POST",t="/add-user",a=e;r>0&&(s="PUT",t="/edit-user",e.user_id=r,a={data:e}),crudaction(a,t,s,function(e){if(e&&submitBtn("#regBtn","validateRegForm()","Click to register"),!1===e.success){let r=e.message;errorToast(r)}else if(!0===e.success){let r=e.message;successToast(r),setTimeout(()=>{gotourl("login")},2550)}})}function logout(e="other"){persistence_remove("user"),persistence_remove("token"),"index"==e?updateHeader():gotourl("login")}function validateLoginForm(){const e=$("#emailOrUsername_input").val().trim(),r=$("#password_input").val().trim();let s=passwordErr=!0;if(""==e)printError("usernameErr","Please enter your username");else{var t=/^[a-zA-Z0-9.@\s]+$/;!1===t.test(e)?printError("usernameErr","Please enter a valid username"):(printError("usernameErr",""),s=!1)}if(""==r?printError("passwordErr","Please enter your password"):r.length<6?printError("passwordErr","Your password should be min 6 characters"):(printError("passwordErr",""),passwordErr=!1),1==(s||passwordErr))return!1;data={username:e,password:r},login(data)}function login(e){disabledBtn("#loginBtn"),crudaction(e,"/user/login","POST",function(e){if(e)if(submitBtn("#loginBtn","validateLoginForm()","Click to Sign in","Submit"),!1===e.success)errorToast(e.message);else if(e.success=!0){persistence("user",e.user),persistence("token",e.token),successToast(e.message);let r=currentLoc(),s=r&&r.gotourl?r.gotourl:"index";setTimeout(()=>{gotourl(s)},2550)}})}function googleSignin(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("success");if("true"===s){let e=r.searchParams.get("uid");const s=r.searchParams.get("username"),t=r.searchParams.get("email"),a=r.searchParams.get("fullname"),o=r.searchParams.get("provider"),n=r.searchParams.get("photo"),i=r.searchParams.get("tkn");e&&(e=parseInt(e));let l={uid:e,username:s,email:t,fullname:a,provider:o,photo:n};successToast("Login success"),setTimeout(()=>{let e=currentLoc();e&&e.user&&e.user.uid==l.uid||persistence("user",l),e&&e.token&&e.token==l.token||persistence("token","Bearer "+i);let r=e&&e.gotourl?e.gotourl:"index";gotourl(r)},2550)}else if("false"===s){const e=r.searchParams.get("message");errorToast(e)}}function googleSignup(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("success");if("true"===s){const e=r.searchParams.get("message");successToast(e),setTimeout(()=>{gotourl("login")},2550)}else if("false"===s){const e=r.searchParams.get("message");errorToast(e)}}function githubSignin(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("success");if("true"===s){let e=r.searchParams.get("uid");const s=r.searchParams.get("username"),t=r.searchParams.get("email"),a=r.searchParams.get("fullname"),o=r.searchParams.get("provider"),n=r.searchParams.get("photo"),i=r.searchParams.get("tkn");e&&(e=parseInt(e));let l={uid:e,username:s,email:t,fullname:a,provider:o,photo:n};successToast("Login success"),setTimeout(()=>{let e=currentLoc();e&&e.user&&e.user.uid==l.uid||persistence("user",l),e&&e.token&&e.token==l.token||persistence("token","Bearer "+i);let r=e&&e.gotourl?e.gotourl:"index";gotourl(r)},2550)}else if("false"===s){const e=r.searchParams.get("message");errorToast(e)}}function githubSignup(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("success");if("true"===s){const e=r.searchParams.get("message");successToast(e),setTimeout(()=>{gotourl("login")},2550)}else if("false"===s){const e=r.searchParams.get("message");errorToast(e)}}function updateHeader(e){let r=getCurrentHost();"localhost"==r?($(".home-nav").html('\n      <a class="navbar-brand" href="http://localhost/zidi-app">\n          <h3 class="masthead-heading text-uppercase">\n            <img src="assets/images/logo.png" height="35px" />\n          </h3>\n      </a>\n      '),$(".sign-in-up-navs").html('\n     <a class="dropdown-item text-dark" href="http://localhost/zidi-app/login"><i class="fa fa-sign-in" aria-hidden="true"></i>&nbsp;Sign in</a>\n      <a class="dropdown-item text-dark" href="http://localhost/zidi-app/register"><i class="fa fa-sign-in" aria-hidden="true"></i>&nbsp;Sign up</a>\n     ')):($(".home-nav").html('\n      <a class="navbar-brand" href="https://zidiapp.com">\n          <h3 class="masthead-heading text-uppercase">\n            <img src="/assets/images/logo.png" height="35px" />\n          </h3>\n      </a>\n      '),$(".sign-in-up-navs").html('\n     <a class="dropdown-item text-dark" href="https://zidiapp.com/login"><i class="fa fa-sign-in" aria-hidden="true"></i>&nbsp;Sign in</a>\n      <a class="dropdown-item text-dark" href="https://zidiapp.com/register"><i class="fa fa-sign-in" aria-hidden="true"></i>&nbsp;Sign up</a>\n     ')),$("#account-1").hide(),$(`#${e}`).hide();let s=!1;crudaction({},"/current-user","GET",function(r){if(r)if(r.success){let e=currentLoc(),r=e.user;$("#account-0").hide(),$("#account-1").show();let t="";t="Local"===r.provider&&r.photo?`<img src='${server_}/user/${r.photo}' style='width: 18px; border-radius: 50%;' />`:"Local"!==r.provider||r.photo?`<img src='${r.photo}' referrerpolicy="no-referrer" style='width: 18px; border-radius: 50%;' />`:`<span class='d-flex justify-content-center small-img'>${r.fullname[0]}</span>`;let a="";"Local"===r.provider||"Google"===r.provider?a=r.fullname.trimStart().split(" ")[0]:"Github"==r.provider?a=r.username:"Facebook"==r.provider?a+=a:"Twitter"==r.provider&&(a=r.fullname.trimStart().split(" ")[0]),$("#user-name").html(a),$("#user-photo").html(t),s=!0}else{let e=currentLoc();e.user;$("#account-1").hide(),$("#account-0").show(),e.user&&persistence_remove("user"),e.token&&persistence_remove("token")}else console.log(r);isAuthorized(e,s),signedUserMenu(e)})}function isAuthorized(e,r){if($(`#${e}`).hide(),r){let r=currentLoc();r&&r.user?"secured"==e||$(`#${e}`).show():"secured"==e?($(`#${e}`).hide(),gotourl("login")):$(`#${e}`).show()}else"secured"==e?($(`#${e}`).hide(),gotourl("login")):$(`#${e}`).show()}function signedUserMenu(e){const r=JSON.parse(localStorage.getItem("persist")),s="index"===e?"Profile":"Home";if(r&&r.user){const t=r.user,{uid:a}=t;let o="",n=getCurrentHost(),i=getCurrentUrl().origin;o="localhost"==n?`${i}/zidi-app/profile?uid=${a}`:`${i}/profile?uid=${a}`,"Home"===s&&(o="index"),$("#dropdown-menu").html(`\n    <a class="dropdown-item text-dark" href="${o}">${s}</a>\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item text-dark" href="javascript:void(0)" onclick="logout('${e}')" id="sign-out">Sign out</a>\n    `)}}function googleOAuth(e){let r=$("#server_").val();window.open(`${r}/google/${e}`,"_self")}function githubOAuth(e){let r=$("#server_").val();window.open(`${r}/github/${e}`,"_self")}function facebookOAuth(){let e=$("#server_").val();window.open(`${e}/facebook`,"_self")}function twitterOAuth(){let e=$("#server_").val();window.open(`${e}/twitter`,"_self")}function forgotPwdValidateForm(){let e=$("#email_input").val().trim(),r=!0;if(""==e)printError("emailErr","Please enter your email address");else{var s=/^\S+@\S+\.\S+$/;!1===s.test(e)?printError("emailErr","Please enter a valid email address"):(printError("emailErr",""),r=!1)}if(1==r)return!1;forgotPassword(e)}function forgotPassword(e){disabledBtn("#forgotPwdBtn"),crudaction({email:e},"/forgot-password","POST",function(e){if(e)if(submitBtn("#forgotPwdBtn","forgotPwdValidateForm()","Click to request password reset link"),e.success){let r=e.message;successToast(r)}else{let r=e.message;errorToast(r)}})}function resetPassword(){disabledBtn("#resetPwdBtn");let e=$("#password_input").val().trim(),r=$("#cpassword_input").val().trim();const s=window.location.href,t=new URL(s),a=t.searchParams.get("uid"),o=t.searchParams.get("token");let n={uid:a,token:o,password:e,cpassword:r};crudaction(n,"/reset-password","POST",function(e){if(e)if(submitBtn("#resetPwdBtn","resetPassword()","Click to reset forgotten password"),e.success){let r=e.message;successToast(r),setTimeout(()=>{gotourl("login")},2550)}else{let r=e.message;"invalid signature"===r?(alert("Reset link expired. Please request new link"),gotourl("forgot-password")):errorToast(r)}})}function validatePwdResetLink(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("uid"),t=r.searchParams.get("token");s&&t||($("#reset-pass-page").html("<div></div>"),setTimeout(()=>{alert("Invalid Link. Please request valid password reset link"),gotourl("forgot-password")},500))}function populateEmail(){const e=window.location.href,r=new URL(e),s=r.searchParams.get("uid");crudaction({},`/user?user_id=${s}`,"GET",function(e){if(e){const{data:r}=e;r&&r.email&&$("#user-email").html(`for <small style='color: #0096FF !important;'><i>${r.email}</i></small>`)}})}